<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>NHL – Props Recommendations</title>
  <link rel="stylesheet" href="/static/style.css" />
  <style>
    .filters{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0 12px}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:12px}
    .card{border:1px solid #2a2a2a;border-radius:12px;padding:12px;background:#0f1115}
    .row{display:flex;align-items:center;gap:10px}
  .logo{width:36px;height:36px;object-fit:contain}
    .title{font-weight:700}
    .badge{font-size:11px;border:1px solid #2a2a2a;border-radius:999px;padding:2px 6px;margin-left:6px}
    .ev{display:inline-block;background:#113a34;color:#a7f3d0;border:1px solid rgba(12, 148, 106, .35);border-radius:999px;padding:2px 6px;font-weight:600}
    .muted{opacity:.8}
    .ladders{margin-top:8px}
    .lad{display:flex;justify-content:space-between;border:1px dashed #2a2a2a;border-radius:8px;padding:6px 8px;margin-top:6px}
    .lad .side{font-weight:600}
    @media (max-width:960px){ .grid{grid-template-columns:repeat(2,minmax(0,1fr))} }
    @media (max-width:680px){ .grid{grid-template-columns:1fr} }
  </style>
  <meta name="color-scheme" content="dark light" />
  <link rel="icon" href="data:," />
  <script>
    function applyFilters(){
      const params = new URLSearchParams(window.location.search);
      const date = document.getElementById('date').value;
      const market = document.getElementById('market').value;
      const min_ev = document.getElementById('min_ev').value || '0';
      const top = document.getElementById('top').value || '200';
      const sortBy = document.getElementById('sortBy').value || 'ev_desc';
      const all = document.getElementById('all').checked ? '1' : '';
      if(date) params.set('date', date); else params.delete('date');
      if(market) params.set('market', market); else params.delete('market');
      params.set('min_ev', min_ev); params.set('top', top);
      if(sortBy) params.set('sortBy', sortBy); else params.delete('sortBy');
      if(all) params.set('all', all); else params.delete('all');
      window.location.search = params.toString();
    }
  </script>
  </head>
<body>
  <div class="container">
  <div class="nav"><a href="/">Cards</a> | <a href="/recommendations">Recs</a> | <a href="/props">Props</a> | <a href="/props/recommendations">Props Recs</a> | <a href="/props/reconciliation">Props Recon</a> | <a href="/props/stats-calibration">Props Cal</a></div>
    <h1>Props Recommendations</h1>
    <form class="filters" onsubmit="applyFilters(); return false;">
      <label>Date <input id="date" type="date" value="{{ date }}" /></label>
      <label>Market
        <select id="market">
          <option value="" {{ 'selected' if (market or '')=='' else '' }}>All</option>
          <option value="SOG" {{ 'selected' if market=='SOG' else '' }}>SOG</option>
          <option value="GOALS" {{ 'selected' if market=='GOALS' else '' }}>Goals</option>
          <option value="ASSISTS" {{ 'selected' if market=='ASSISTS' else '' }}>Assists</option>
          <option value="POINTS" {{ 'selected' if market=='POINTS' else '' }}>Points</option>
          <option value="SAVES" {{ 'selected' if market=='SAVES' else '' }}>Saves</option>
          <option value="BLOCKS" {{ 'selected' if market=='BLOCKS' else '' }}>Blocked Shots</option>
        </select>
      </label>
      <label>Min EV <input id="min_ev" type="number" step="0.01" value="{{ min_ev }}" /></label>
      <label>Top <input id="top" type="number" step="1" value="{{ top }}" /></label>
      <label>Sort
        <select id="sortBy">
          <option value="ev_desc" {{ 'selected' if (sortBy or '')=='ev_desc' else '' }}>EV desc</option>
          <option value="ev_asc" {{ 'selected' if (sortBy or '')=='ev_asc' else '' }}>EV asc</option>
          <option value="name" {{ 'selected' if (sortBy or '')=='name' else '' }}>Name</option>
          <option value="market" {{ 'selected' if (sortBy or '')=='market' else '' }}>Market</option>
        </select>
      </label>
      <label>Side
        <select id="side">
          <option value="both" {{ 'selected' if (side or '')=='both' else '' }}>Both</option>
          <option value="over" {{ 'selected' if (side or '')=='over' else '' }}>Over</option>
          <option value="under" {{ 'selected' if (side or '')=='under' else '' }}>Under</option>
        </select>
      </label>
      <label><input id="all" type="checkbox" {{ 'checked' if all else '' }} /> All</label>
      <button type="submit">Apply</button>
  <a class="button push-right" href="/props/recommendations.csv?date={{ date }}">Download CSV</a>
    </form>
    <div class="muted">{{ cards|length }} players</div>
    <div class="grid">
      {% for c in cards %}
        <div class="card">
          <div class="row">
            {% if c.team_logo %}
              <img class="logo" src="{{ c.team_logo }}" alt="{{ c.team_abbr }}" />
            {% endif %}
            {% if c.photo %}
              <img class="avatar" src="{{ c.photo }}" alt="{{ c.player }}" />
            {% endif %}
            <div>
              <div class="title">{{ c.player }}</div>
              <div class="muted">{{ c.team_abbr or c.team or '—' }} · Best EV <span class="ev">{{ '%.3f' % c.best_ev if c.best_ev is not none else '—' }}</span></div>
            </div>
          </div>
          {% if c.markets %}
            {% for m in c.markets %}
              <div class="row" style="margin-top:10px; gap:8px; align-items:flex-start;">
                <div class="badge">{{ m.market }}</div>
                <div class="muted">λ {{ '%.2f' % m.proj if m.proj is not none else '—' }}</div>
                <div class="muted">P(Over) {{ '%.1f' % (m.p_over*100) }}%{% if m.p_over is none %}—{% endif %}</div>
                {% if m.primary_line is not none %}
                  <div class="muted">Line {{ m.primary_line }}</div>
                {% endif %}
                {% if m.best_side %}
                  <div class="muted">Best {{ m.best_side }} @ {{ m.best_book or '—' }} {{ m.best_price if m.best_price is not none else '—' }}</div>
                {% endif %}
                <div class="muted">Best EV <span class="ev">{{ '%.3f' % m.best_ev if m.best_ev is not none else '—' }}</span></div>
              </div>
              <div class="ladders">
                {% for l in m.ladders %}
                  <div class="lad">
                    <div>{{ l.line }}</div>
                    <div class="side">{{ l.side or 'Over' }}</div>
                    <div>O {{ l.over_price if l.over_price is not none else '—' }} · U {{ l.under_price if l.under_price is not none else '—' }}</div>
                    <div>{{ l.book or '—' }}</div>
                    <div><span class="ev">{{ '%.3f' % l.ev if l.ev is not none else '—' }}</span></div>
                  </div>
                {% endfor %}
              </div>
            {% endfor %}
          {% endif %}
        </div>
      {% endfor %}
    </div>
  </div>
</body>
</html>
